<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Project 1: Images of the Russian Empire</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="../assets/css/main.css" rel="stylesheet">
</head>

<body class="portfolio-details-page">
  <main class="main">

    <!-- Page Title -->
    <div class="page-title dark-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">
          <a href="/CS180/" class="navbar-title-link">Joel's CS180 Projects</a>
        </h1>

        <nav class="breadcrumbs">
          <ol>
            <li><a href="/CS180/">Joel's CS180 Projects</a></li>
            <li class="current">Project 1</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <section id="project-0" class="project-section container py-5">

      <!-- Page Title -->
      <div class="section-title text-center">
        <h2>Project 1: Images of the Russian Empire</h2>
        <p>Colorizing the <a href="https://www.loc.gov/collections/prokudin-gorskii/">Prokudin-Gorskii</a> photo
          collection.</p>
      </div>

      <!-- Background -->
      <div class="project-part mb-5">
        <h3>Background</h3>
        <p><a href="https://en.wikipedia.org/wiki/Sergei_Prokudin-Gorskii">Sergei Mikhailovich Prokudin-Gorskii</a> (1863-1944) [Сергей Михайлович Прокудин-Горский, to his Russian friends] was a man well ahead of his time. Convinced, as early as 1907, that color photography was the wave of the future, he won Tzar's special permission to travel across the vast Russian Empire and take color photographs of everything he saw including the only color portrait of Leo Tolstoy. And he really photographed everything: people, buildings, landscapes, railroads, bridges... thousands of color pictures! His idea was simple: record three exposures of every scene onto a glass plate using a red, a green, and a blue filter. Never mind that there was no way to print color photographs until much later -- he envisioned special projectors to be installed in "multimedia" classrooms all across Russia where the children would be able to learn about their vast country. Alas, his plans never materialized: he left Russia in 1918, right after the revolution, never to return again. Luckily, his RGB glass plate negatives, capturing the last years of the Russian Empire, survived and were purchased in 1948 by the Library of Congress. The LoC has recently digitized the negatives and made them available on-line.
        </p>
      </div>

      <!-- The Problem -->
      <div class="project-part mb-5">
        <h3>The Problem</h3>
        <p>However, to recreate Prokudin-Gorskii's work in its full glory, we need a way to stack the red, green, blue data captured on seperate planes into a single RGB images.
        </p>
        <div class="gallery-card text-center mx-auto">
          <a href="../assets/img/project1/emir.jpg" class="glightbox" title="Emir R, G, & B tiles scan">
            <img src="../assets/img/project1/emir.jpg" alt="Emir" class="gallery-img">
          </a>
          <p class="caption mt-2">Emir R, G, & B tiles scan.</p>
        </div>

      </div>
      
      <!-- Part 1: Single-scale Alignment -->
      <div class="project-part mb-5">
        <h3>Part 1: Single-scale Alignment:</h3>
        <p><b>Alignment Metrics</b></p>
        <p>To compute score the alignment between any two given channels, there are a variety of metrics one can use.
          For this project, we implemented <b>L2 Eucledian Distance</b> and <b>Normalized Cross Correlation</b>:</p>
        <p><b>L2 Norm (Eucledian Distance):</b></p>
        <p>
          \[\text{L2}(I_1, I_2) = \sum_{x, y} (I_1(x, y) - I_2(x, y))^2\]
        </p>
        <p><b>Normalized Cross Correlation (NCC):</b></p>
        <p>
          \[
          \text{NCC}(I_1, I_2) = \frac{I_1}{\|I_1\|} \cdot \frac{I_2}{\|I_2\|}
          \]
          Where \(I_1\) and \(I_2\) are the vectors containing the pixel values of two input images.
        </p>

        <p>By exhaustively searching over a window of possible displacements (e.g. [-15,15] pixels), scoring each one using one of the above metrics, and taking the displacement with the best score, we can find the displacement vector that aligns any one channel with another. Repeating this process for two channels onto the third, we can properly stack the channels to recover an single RGB image, as desired.</p>

        <p><b>Initial Results</b></p>
        <p>Note: You can click to expand images.</p>
        <!-- Initial Results: Selfie Comparison Gallery -->
        <div class="gallery d-flex flex-wrap justify-content-center gap-4 my-4">

          <!-- Image Card -->
          <div class="gallery-card text-center">
            <a href="../assets/img/project1/low-res/cathedral_aligned.jpg" class="glightbox" title="Cathedral (metric = L2)">
              <img src="../assets/img/project1/low-res/cathedral_aligned.jpg" alt="cathedral aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">Cathedral (metric = L2).</p>
          </div>

          <div class="gallery-card text-center">
            <a href="../assets/img/project1/low-res/monastery_misaligned.jpg" class="glightbox" title="Monastery (metric = L2)">
              <img src="../assets/img/project1/low-res/monastery_misaligned.jpg" alt="monastery aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">Monastery (metric = L2).</p>
          </div>

          <div class="gallery-card text-center">
            <a href="../assets/img/project1/low-res/tobolsk_aligned.jpg" class="glightbox" title="Tobolsk (metric = L2)">
              <img src="../assets/img/project1/low-res/tobolsk_aligned.jpg" alt="tobolsk aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">Tobolsk (metric = L2).</p>
          </div>
        </div>
        <p>
          It was mostly a success, but the Monastery image alignment seems to have been thrown off by imperfections in some of the channel, resulting in certain displacements scoring higher then they should.
        </p>
        <p><b>Results with cropping</p></b>
        <div class="gallery d-flex flex-wrap justify-content-center gap-4 my-4">

          <!-- Image Card -->
          <div class="gallery-card text-center">
            <a href="../assets/img/project1/low-res/cathedral_aligned.jpg" class="glightbox" title="Cathedral (metric = L2, max_shift=15)">
              <img src="../assets/img/project1/low-res/cathedral_aligned.jpg" alt="cathedral aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">Cathedral (metric = L2, max_shift=15, crop=10%, ag=(2,5), ar=(3,12)).</p>
          </div>

          <div class="gallery-card text-center">
            <a href="../assets/img/project1/low-res/monastery_aligned.jpg" class="glightbox" title="Monastery (metric = L2, max_shift=15)">
              <img src="../assets/img/project1/low-res/monastery_aligned.jpg" alt="monastery aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">Monastery (metric = L2, max_shift=15, crop=10%, ag=(2,-3), ar=(2,3)).</p>
          </div>

          <div class="gallery-card text-center">
            <a href="../assets/img/project1/low-res/tobolsk_aligned.jpg" class="glightbox" title="Tobolsk (metric = L2, max_shift=15)">
              <img src="../assets/img/project1/low-res/tobolsk_aligned.jpg" alt="tobolsk aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">Tobolsk (metric = L2, max_shift=15, crop=10%, ag=(3,3), ar=(3,6)).</p>
          </div>
        </div>
        <p>Cathedral and Tobolsk align all the same, but Monastery is now aligned properly. Success!</p>
        <p>Note: The results were the same using metric = NCC.</p>
        <p>Note: To be clear, this crop is not one of the final image, just those copies in memory used to compute the alignment metric.</p>
      </div>
      

      <!-- Part 2: Multi-scale pyramid alignment (with NCC / L2) -->
      <div class="project-part mb-5">
        <h3>Part 2: Multi-scale pyramid alignment (with NCC / L2)</h3>
        
        <div class="gallery-card text-center mx-auto">
          <a href="../assets/img/project1/galleries/pyramid example.png" class="glightbox" title="Gaussian Pyramid">
            <img src="../assets/img/project1/galleries/pyramid example.png" alt="Gaussian Pyramid" class="gallery-img">
          </a>
          <p class="caption mt-2">Gaussian Pyramid.</p>
        </div>
        <p>
          Our implementation of single-scale alignment works well on these lower resolution images, but the runtime quickly becomes impractical for higher resolution images. To address this, we can use a multi-scale pyramid approach to align images. A pyramid is a data structure that allows us to represent an image at multiple scales, with each level of the pyramid representing the image at a lower resolution (in our case by a factor 2). This allows us to quickly compute the alignment at a lower resolution, and then refine at higher resolutions. More specifically:
        </p>
        <p>
          1. Build a Gaussian pyramid for each channel of the red, green, blue channels respectively. Let the height of the pyramid(s) be h.
        </p>
        <p>
          2. For each level of the pyramid from <em>h</em>-1 to 0 (i.e. lowest resolution to highest resolution), compute 
          \[
            \max_{(x,y)} \; alignment\_metric(I_1, I_2)
          \]
          where \( I_1 \) and \( I_2 \) are the (possibly cropped) images at the current level of the pyramid, and \( alignment\_metric \) is either L2 or NCC over a window size that is halved at each descent to the next level. The search window is centered at the displacement vector found at the previous level of the pyramid (scaled up by two to account for the resolution gain).
        </p>
        <p>
          3. The displacement vector found at the highest resolution level of the pyramid is the final displacement vector.
        </p>
        <p><b>Results (on higher resolution tile scans)</b></p>
        <p>Note: Click to expand image galleries</p>
        <div class="gallery d-flex flex-wrap justify-content-center gap-4 my-4">
          <!-- Image Card -->
          <div class="gallery-card text-center mx-auto">
            <a href="../assets/img/project1/galleries/L2_output.png" class="glightbox" title="w/L2 metric (max_shift=15, crop=10%)">
              <img src="../assets/img/project1/galleries/L2_output.png" alt="aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">w/L2 metric (max_shift=15, crop=10%).</p>
          </div>
          <div class="gallery-card text-center mx-auto">
            <a href="../assets/img/project1/galleries/NCC_output.png" class="glightbox" title="w/NCC metric (max_shift=15, crop=10%)">
              <img src="../assets/img/project1/galleries/NCC_output.png" alt="aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">w/NCC metric (max_shift=15, crop=10%).</p>
          </div>
        </div>

        <p>The L2 metric wasn't able to quite line up all images. However, using NCC, all the images look great! Except...</p>
        <div class="gallery d-flex flex-wrap justify-content-center gap-4 my-4">
          <!-- Image Card -->
          <div class="gallery-card text-center mx-auto">
            <a href="../assets/img/project1/emir_aligned.jpg" class="glightbox" title="Emir (mis)aligned.">
              <img src="../assets/img/project1/emir_aligned.jpg" alt="aligned, metric=L2" class="gallery-img">
            </a>
            <p class="caption mt-2">Emir (mis)aligned.</p>
          </div>
        </div>
        <p>To understand what's going on here, let's take a look at the channels seperateley:</p>
        <div class="gallery d-flex flex-wrap justify-content-center gap-4 my-4">
          <!-- Image Card -->
          <div class="gallery-card text-center mx-auto">
            <a href="../assets/img/project1/emir_channel_debugging.png" class="glightbox" title="Emir channels.">
              <img src="../assets/img/project1/emir_channel_debugging.png" alt="Emir channels" class="gallery-img">
            </a>
            <p class="caption mt-2">Emir channels.</p>
          </div>
        </div>
        <p>From this it is clear that the images does not actually have the same brightness values (they are different color channels) for corresponding pixels (most notably, Emir's clothing). To resolve this issue, you'd need a more cleverer metric. For instance, one could perform an edge detecion convolution on the two channels in quesiton and perform the alignment on the outputs. This will be left for future work as the current implementiaton is succesfull on all other images.</p>
      </div>

      <!-- Part 3: Bonus images -->
      <div class="project-part mb-5">
        <h3>Part 3: More alignment on bonus images!</h3>
        <p>Check on the algorithm succesfully align this set of pictures taken of tools and animals across Russia:</p>
        <div class="gallery d-flex flex-wrap justify-content-center gap-4 my-4">
          <!-- Image Card -->
          <div class="gallery-card text-center mx-auto">
            <a href="../assets/img/project1/galleries/extra_output.png" class="glightbox" title="Bonus galery.">
              <img src="../assets/img/project1/galleries/extra_output.png" alt="Emir channels" class="gallery-img">
            </a>
            <p class="caption mt-2">Bonus gallery.</p>
          </div>
        </div>
    </section>

  </main>

  <footer id="footer" class="footer position-relative">

    <div class="container">
      <div class="copyright text-center ">
        <p>© <span>Copyright 2026.</span> <span>Joel's CS180 Projects.</span></p>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/typed.js/typed.umd.js"></script>
  <script src="../assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="../assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <!-- Main JS File -->
  <script src="../assets/js/main.js"></script>

</body>

</html>